services:
  - type: web
    name: zillow-scraper-trigger
    env: node
    plan: free
    buildCommand: npm install
    startCommand: node -e "console.log('Trigger service ready. Use Render API to trigger KWG scraping.'); setInterval(() => {}, 1000);"
    envVars:
      - key: NODE_ENV
        value: production
      - key: SCRAPERAPI_KEY
        sync: false
      - key: SMARTPROXY_USER
        sync: false
      - key: SMARTPROXY_PASS
        sync: false

  - type: cron
    name: zillow-scraper-la-region
    env: node
    plan: free
    buildCommand: npm install
    startCommand: npm run enterprise
    schedule: "0 13,1 * * *"  # Run daily at 8 AM EST (1 PM UTC) and 8 PM EST (1 AM UTC)
    envVars:
      - key: NODE_ENV
        value: production
      - key: SCRAPERAPI_KEY
        sync: false
      - key: FIRST_RUN
        value: "false"  # Set to "true" for first run, then change to "false" for subsequent runs
      - key: SMARTPROXY_USER
        sync: false
      - key: SMARTPROXY_PASS
        sync: false
      - key: EMAIL_USER
        sync: false
      - key: EMAIL_PASS
        sync: false
      - key: NOTIFICATION_EMAIL
        sync: false

  - type: cron
    name: zillow-scraper-delayed-retry
    env: node
    plan: free
    buildCommand: npm install
    startCommand: npm run delayed:retry
    schedule: "30 13,1 * * *"  # Run 30 minutes after main scrape (8:30 AM EST and 8:30 PM EST)
    envVars:
      - key: NODE_ENV
        value: production
      - key: SCRAPERAPI_KEY
        sync: false
      - key: SMARTPROXY_USER
        sync: false
      - key: SMARTPROXY_PASS
        sync: false

  # NEW UNIFIED SCRAPER - RapidAPI (Recommended)
  - type: cron
    name: unified-scraper-daily
    env: node
    plan: free
    buildCommand: npm install
    startCommand: node unified-scraper.js all
    schedule: "0 3 * * *"  # Every day at 3 AM UTC (10 PM EST / 7 PM PST)
    envVars:
      - key: NODE_ENV
        value: production
      - key: RAPIDAPI_KEY
        value: fad289c8b7msh67ab38f37446aedp1132acjsnc18eaf48b653